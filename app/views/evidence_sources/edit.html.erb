<div class="container">
    <script>
        $().ready(function(){
            console.log("page load down");
            $('#new-evidence-item').click(function(){
                console.log("to create new evience item!");
                $('#new-evidence-item-modal').modal();
            });
        });
    </script>
    <h2>EDIT EVIDENCE SOURCE</h2>
    <div>
        <table class="table table-stripped">
            <tr>
                <th>title</th>
                <td><%= @evidence_source.title %></td>
            </tr>
            <tr>
                <th>misc</th>
                <td> ID:<%=@evidence_source.id%> | <%=@evidence_source.status%>&nbsp;
                        | category:<%=@evidence_source.category%>&nbsp;
                        | year:<%=@evidence_source.year%>&nbsp;
                        | volume:<%=@evidence_source.volume_number%>&nbsp;
                        | issue:<%=@evidence_source.issue_number%>&nbsp;
                        | page:<%=@evidence_source.page_str%>&nbsp;
                </td>
            </tr>
            <tr>
                <th>authors</th>
                <td>
                    <% @evidence_source.evidence_source_authors.each do |author| %>
                        <%=author.name_abbr%> |
                    <% end %>
                </td>
            </tr>
            <tr>
                <th>source</th>
                <td><%=@evidence_source.source_title%></td>
            </tr>
            <tr><th>DOI</th><td><%=@evidence_source.DOI%></td></tr>
            <tr><td></td><td></td></tr>
        </table>
    </div>
    <hr/>
    <div>
        <h2>research design</h2>
        <button id="btn-edit-research-design" class="btn btn-warning">
            <span class="glyphicon glyphicon-edit"></span>&nbsp;EDIT&nbsp;
        </button>
        
        <table class="table table-stripped">
            <script>
                
                var _research_design = [
                    <% rd_list = ResearchDesign.where(evidence_source_id: @evidence_source.id) %>
                    <% rd_list.each do |rd| %>
                    { "category": "<%= rd.category %>", "ref_id": "<%= rd.ref_id %>", "text": "<%= rd.ref_text %>"},
                    <% end %>
                ];
                $().ready(function(){
                    $.each(_research_design, function(index){
                        obj = _research_design[index];
                        console.log(obj);
                        if (obj['category'] === 'METHOD') {
                            var d = $('#research-design-table-methods-div');
                            d.html(d.html() + '&nbsp;<kbd>' + obj['text'] + '</kbd>&nbsp;');
                        } else if (obj['category'] === 'PARTICIPANT') {
                            var d = $('#research-design-table-participants-div');
                            d.html(d.html() + '&nbsp;<kbd class="text-capitalize">' + obj['text'] + '</kbd>&nbsp;');
                        } else if (obj['category'] === 'METRIC') {
                            var t = $('#research-design-table-metric-table');
                            $('<p class="text-primary">' + obj['text'] + '</p>').appendTo(t);
                        }
                    });
                    
                    $('#btn-edit-research-design').click(function(){
                        var _research_desing_aim = "<%= @evidence_source.research_aim %>";
                        _reset_edit_research_design_form(_research_desing_aim, _research_design);
                        $('#edit-research-design-modal').modal();
                    });
                });
            </script>
            <tr>
                <th>Question (Aim)</th>
                <td><p class="text-warning"><%= @evidence_source.research_aim %></p></td>
            </tr>
            <% rd_list = ResearchDesign.where(evidence_source_id: @evidence_source.id) %>
            <tr>
                <th>Method(s)</th>
                <td><div id="research-design-table-methods-div"></div></td>
            </tr>
            <tr>
                <th>Participants</th>
                <td><div id="research-design-table-participants-div"></div></td>
            </tr>
            <tr>
                <th>Metric(s)</th>
                <td>
                    <div id="research-design-table-metric-table">
                    </div>
                </td>
            </tr>
            <tr><th></th><td></td></tr>
        </table>
    </div>
    <div class="modal fade" id="edit-research-design-modal" role="dialog" data-backdrop="static">
        <%= render 'edit_research_desing' %>
    </div>
    <hr/>
    <div>
        <div><h2>evidence items</h2><button id="new-evidence-item" class="btn btn-success">Create New</button></div>
        <div class="modal fade" id="new-evidence-item-modal" role="dialog" data-backdrop="static">
            <%= render 'new_evidence_item' %>
        </div>
    </div>
</div>

<hr/>
<hr/>
<hr/>
<div>
    <%= render 'new_evidence_item' %>
</div>
